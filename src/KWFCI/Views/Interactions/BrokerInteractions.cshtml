@model KWFCI.Models.ViewModels.InteractionVM

@{
    ViewBag.Title = "Interactions";
}

<div>
    <div class="col-xs-12">
        
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Staff</th>
                    <th>Notes</th>
                    <th>Date</th>
                    <th>Next Step</th>
                    <th>Broker</th>
                </tr>
            </thead>
            <tbody class="editTable">
                @foreach (Interaction a in Model.Interactions)
                {
                    var entityID = a.InteractionID;
                    Model.NewInteraction = a;
                    
                    <tr>
                        <td>@ViewBag.StaffEmail</td>
                        <td style="min-width:380px;max-width:380px;">
                            <a href="#" class="inactive" data-toggle="modal" data-target="#editInteractionNotes" data-id="@entityID">
                                @if (a.Notes != null && a.Notes != "")
                                {
                                    @a.Notes
                                }
                                else
                                {
                                    <img class="mh-20px w-100p" src="~/lib/images/caucasion.jpg" data-id="@entityID" />
                                }
                            </a>
                        </td>

                        
                        <td style="min-width:110px;max-width:110px;" asp-for="@Model.NewInteraction.DateCreated">
                            <!--Attribute necessary for datepicker to function: data-provide="datepicker"
                                Attributes that server as configuration options: all attributes that start with data-date- -->
                            <input type="text" data-date-autoclose="true" data-date-clear-btn="true" data-date-today-highlight="true" data-provide="datepicker" class="form-control interactionDate" data-id="@entityID"
                            @if (a.DateCreated != null)
                            {
                                //Remove the time from the display
                                string[] splitDate = a.DateCreated.ToString().Split(' ');
                                string date = splitDate[0];

                                @:value="@date" />
                            }
                            else
                            {
                                @:value="" />
                            }
                        </td>

                        
                        <td style="min-width:380px;max-width:380px;">
                            <div class="col-xs-9">
                                <a href="#" class="inactive" data-toggle="modal" data-target="#editInteractionNextStep" data-id="@entityID">
                                    @if (a.NextStep != null && a.NextStep != "")
                                    {
                                        @a.NextStep
                                    }
                                    else
                                    {
                                        <img class="mh-20px w-100p" src="~/lib/images/caucasion.jpg" data-id="@entityID" />
                                    }
                                </a>
                            </div>
                            <div class="col-xs-3">
                                <button type="button" class="btn btn-success" style="padding: 0px 7px 0px 7px;float:right;" data-target="#newKWTask"><div>Add</div><div>Alert</div></button>
                            </div>
                        </td>
                        
                        
                        <td style="min-width:170px;max-width:170px;">
                            @ViewBag.BrokerName
                        </td>
                    </tr>
             }
            </tbody>
        </table>
    </div>
</div>

<form class="hidden" asp-action="Edit" asp-controller="Interactions">
    <!--Value is populated with jQuery based on what value was entered into the date box-->
    <input type="hidden" class="addDate" asp-for="@Model.NewInteraction.DateCreated" value=""/>
    <input type="hidden" class="addID" asp-for="@Model.NewInteraction.InteractionID" value="" />
    <input type="hidden" asp-for="@Model.Field" value="Date Created" />
    <input type="hidden" asp-for="@Model.BrokerID" />
    <!--Triggered with jQuery-->
    <button type="submit" class="hidden submitButton"></button>
</form>


@Html.ActionLink("New Interaction", "AddInteraction", "Interactions", new { BrokerID = Model.Broker.BrokerID })

@Html.Partial("Modals/_AddKWTaskModal", Model)
@Html.Partial("Modals/_EditInteractionNotesModal", Model)
@Html.Partial("Modals/_EditInteractionNextStepModal", Model)
<style>
    table, tr, th {
        border: 1px solid black;
    }
</style>
